# Configuration for SLAM-ASR on Common Voice Danish
# Low-resource Speech LLM for SPEAKABLE 2026
# Using Whisper-base (multilingual) + Multilingual LLM

model:
  model_name: ASRLLM
  file: models/model.py:ASRLLM
  
  # LLM - Qwen2.5 
  llm_model_name: qwen2.5-3B
  llm_model: Qwen/Qwen2.5-3B
  llm_dim: 2048
  
  # Alternative LLMs (uncomment to use):
  # Option 2: LLaMA 3.2 (English-focused but may work)
  # llm_model_name: llama3.2-3B   
  # llm_model: meta-llama/Llama-3.2-3B
  # llm_dim: 3072
  
  # Option 3: Nordic-focused model
  # llm_model_name: gpt-sw3-1.3b
  # llm_model: AI-Sweden-Models/gpt-sw3-1.3b
  # llm_dim: 2048
  
  llm_model_path: null
  llm_type: decoder_only
  
  # Whisper encoder - base is multilingual (supports Danish)
  # For layer ablation experiments, modify encoder.py
  encoder_model_name: whisper-base
  encoder_model: base  # NOT "base.en" - we need multilingual!
  encoder_ds_rate: 2
  encoder_model_path: null
  encoder_dim: 512
  
  # Projector settings
  projector: linear
  projector_ds_rate: 5
  modal: audio
  normalize: false
  encoder_type: finetune

train:
  model_name: ASRLLM
  run_validation: true
  batch_size: 8
  batching_strategy: packing
  context_length: 384
  gradient_accumulation_steps: 2
  grad_clip: 1.0
  num_epochs: 20
  num_workers: 4
  warmup_steps: 200
  total_steps: 10000
  validation_interval: 500
  lr: 1.0e-4
  weight_decay: 0.01
  gamma: 0.85
  seed: 42
  use_fp16: false
  mixed_precision: true
  val_batch_size: 8

  use_peft: false
  output_dir: outputs_danish_5h/
  freeze_layers: false
  num_freeze_layers: 0
  quantization: false
  one_gpu: true
  save_model: true
  use_fast_kernels: false
  
  # SLAM-ASR: Freeze encoder and LLM, only train projector
  freeze_llm: true
  freeze_encoder: true

scheduler: 
  name: cosine_with_warmup
  total_training_steps: 5000
  warmup_steps: 200

early_stopping: 
  monitor: val/loss
  mode: min 
  patience: 3
  min_delta: 0.001

data:
  dataset: speech_dataset
  file: datamodules/datasets.py:get_speech_dataset
  
  # Common Voice Danish data paths (generated by get_dataset.py)
  train_data_path: data/common_voice_da/train.jsonl
  val_data_path: data/common_voice_da/validation.jsonl
  test_data_path: data/common_voice_da/test.jsonl
  
  train_split: train
  val_split: val
  test_split: test
  prompt: null
  data_path: null
  max_words: null
  max_mel: null
  fix_length_audio: -1
  inference_mode: false
  input_type: mel
  mel_size: 80
  normalize: false
  
  # Variable length audio support (important for Common Voice)
  use_variable_length: true
  max_audio_length: 30  # seconds

log:
  use_wandb: true
  wandb_dir: ./wandb
  wandb_entity_name: ASRLLM
  wandb_project_name: SLAM_ASR_Danish
  wandb_exp_name: whisper_base_qwen_5h_danish
  log_dir: ./logs
  log_filename: train_danish.log
  log_interval: 50
